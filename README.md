# Optical Flow Node

Этот репозиторий содержит ROS-пакет для вычисления оптического потока на изображениях, предназначенный для использования с реальным дроном.

## Описание

Пакет реализует вычисление оптического потока для обработки изображений с камеры дрона. Он может быть использован для задач навигации, стабилизации и анализа движения.

## Установка

1. Клонируйте репозиторий в рабочую область ROS:
   ```bash
   git clone https://github.com/NCFU-SKB/ros2-optical-flow-node.git
   ```
2. Перейдите в корень рабочей области и соберите пакет:
   ```bash
   cd <ваша_рабочая_область или сам пакет>
   colcon build --packages-select optical_flow_node
   ```
3. Активируйте рабочую область:
   ```bash
   source install/setup.bash
   ```

## Зависимости

- ROS 2 (например, Foxy, Humble или другой поддерживаемый дистрибутив)
- OpenCV
- CMake
- std_msgs, sensor_msgs (ROS 2)

Установите зависимости через пакетный менеджер вашей системы или с помощью rosdep:
```bash
rosdep install --from-paths src --ignore-src -r -y
```

## Запуск

1. Убедитесь, что рабочая область собрана и активирована:
   ```bash
   source install/setup.bash
   ```
2. Запустите узел оптического потока:
   ```bash
   ros2 run optical_flow_node optical_flow_node
   ```
   
## Используемые топики

### Подписка на топики

В коде осуществляется подписка на следующие ROS-топики:

- `/image_raw` — входящий поток изображений с камеры.
- `/camera_info` — информация о калибровке камеры.
- `/rangeLidar` — данные с дальномера (лидара).

### Публикация в топики

Пакет публикует данные в следующие ROS-топики:

- `/uav1/mavros/px4flow/raw/send` — публикация сообщений оптического потока.
- `/shift` — публикация рассчитанного сдвига.
- `angular_velocity` — публикация оценённой угловой скорости.
- `debug` — публикация отладочных изображений.

**Примечание:** Названия топиков могут отличаться в зависимости от вашей конфигурации и должны быть скорректированы при необходимости.

## Заметки

1. Проект находится в не завершенном состоянии и требует "полировки"
2. В зависимости от направлении камеры необходимо изменить конвертацию координат в коде
3. В зависимости от названий топиков необходимо поменять названия в коде
